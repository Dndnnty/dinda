{% if preview_pre %}
  {% if not pre_ok %}
    <div class="mt-3 rounded-xl bg-rose-500/15 border border-rose-400/30 px-4 py-3 text-sm">
      Preview prapemrosesan terdeteksi belum memuat kolom hasil transformasi (jenis_pestisida_kode, packaging_kode_angka, volume_normalisasi). Jalankan prapemrosesan ulang.
    </div>
  {% endif %}
  <div class="mt-3 flex items-center justify-between gap-2 text-xs text-slate-200/70">
    <div>Total {{ preview_pre.total_rows }} baris · Halaman {{ preview_pre.page }}/{{ preview_pre.total_pages }} · 10 baris/halaman</div>
    <div class="flex items-center gap-2">
      <!-- Logic pagination sederhana: Tampilkan max 10 halaman sekitar halaman aktif -->
      {% set start_page = preview_pre.page - 4 %}
      {% if start_page < 1 %}{% set start_page = 1 %}{% endif %}
      {% set end_page = start_page + 9 %}
      {% if end_page > preview_pre.total_pages %}{% set end_page = preview_pre.total_pages %}{% endif %}
      
      {% if preview_pre.page > 1 %}
        <a href="{{ url_for('prapemrosesan', page_pre=preview_pre.page-1) }}" class="rounded-lg bg-white/10 hover:bg-white/15 border border-white/15 px-3 py-1">Prev</a>
      {% endif %}
      
      {% for p in range(start_page, end_page + 1) %}
        <a href="{{ url_for('prapemrosesan', page_pre=p) }}" class="rounded-lg {% if p == preview_pre.page %}bg-indigo-500 text-white{% else %}bg-white/10 hover:bg-white/15{% endif %} border border-white/15 px-3 py-1">{{ p }}</a>
      {% endfor %}
      
      {% if preview_pre.page < preview_pre.total_pages %}
        <a href="{{ url_for('prapemrosesan', page_pre=preview_pre.page+1) }}" class="rounded-lg bg-white/10 hover:bg-white/15 border border-white/15 px-3 py-1">Next</a>
      {% endif %}
    </div>
  </div>
  {% if kolom_tambahan and kolom_tambahan|length > 0 %}
    <div class="mt-3 rounded-xl bg-black/20 border border-white/10 px-4 py-3 text-xs text-slate-200/80">
      Kolom baru hasil transformasi: {{ kolom_tambahan|join(', ') }}
    </div>
  {% endif %}
  <div class="mt-3 overflow-auto rounded-xl border border-white/10">
    <table class="min-w-full text-xs">
      <thead class="bg-black/20">
        <tr>
          {% for c in preview_pre.columns %}
            <th class="px-3 py-2 text-left font-medium text-slate-200/80 whitespace-nowrap">{{ c }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody class="divide-y divide-white/10">
        {% for row in preview_pre.rows %}
          <tr class="hover:bg-white/5">
            {% for c in preview_pre.columns %}
              <td class="px-3 py-2 text-slate-200/80 whitespace-nowrap">{{ row[c] }}</td>
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="mt-3 text-sm text-slate-200/70">Jalankan prapemrosesan untuk menghasilkan data bersih.</div>
{% endif %}